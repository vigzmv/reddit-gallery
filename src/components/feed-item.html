<template>
  <style>
    article {
      position: relative;
      opacity: 0.96;
      transition: 0.16s ease transform;
    }

    article:hover {
      opacity: 1;
      transform: scale(1.08);
    }

    article:hover a span {
      border-bottom: 4px solid #ff7300d2;
    }

    a img {
      width: 100%;
      height: 168px;
      object-fit: cover;
    }

    a span {
      position: absolute;
      bottom: 1px;
      padding: 6px;
      width: calc(100% - 12px);
      height: 24px;
      margin-bottom: 0;
      background-color: #fff4efec;
      color: black;
      font-size: 10px;
      border-bottom: 3px solid #ffa60085;
    }
  </style>

  <article>
    <a target="_blank">
      <span></span>
      <img src="https://placekitten.com/200/200">
    </a>
  </article>

</template>

<script>

  (function () {

    function isUrl(s) {
      const regexp = /(ftp|http|https)/;
      return regexp.test(s);
    }

    const thatDoc = document;
    const thisDoc = (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;
    const template = thisDoc.querySelector('template').content;

    class FeedItem extends HTMLElement {
      static get observedAttributes() {
        return ['image', 'link', 'title'];
      }

      set image(url) {
        this.setAttribute('image', url);
      }

      get image() {
        return this.getAttribute('image');
      }

      set link(url) {
        this.setAttribute('link', url);
      }

      get link() {
        return this.getAttribute('link');
      }

      set title(str) {
        this.setAttribute('title', str);
      }

      get title() {
        return this.getAttribute('title');
      }

      connectedCallback() {
        this.attachShadow({ mode: 'open' });
        this.shadowRoot.appendChild(thatDoc.importNode(template, true));

        this.updateItem();
      }

      attributeChangedCallback() {
        this.updateItem();
      }

      updateItem() {
        if (this.shadowRoot) {
          let { title, image } = this;
          if (title.length > 56) {
            title = `${title.slice(0, 56)}...`;
          }

          image = isUrl(image) ? image : 'https://placekitten.com/180/180';

          if (this.image) this.shadowRoot.querySelector('img').setAttribute('src', image);
          if (this.link) this.shadowRoot.querySelector('a').setAttribute('href', this.link);
          if (this.title) this.shadowRoot.querySelector('span').textContent = title;
        }
      }
    }

    window.customElements.define('feed-item', FeedItem);
  })();

</script>